trigger:
  batch: false
  branches:
    include:
      - master

jobs:
- job: "SDKAutomation"
  displayName: SDK Automation
  pool:
    vmImage: 'Ubuntu 16.04'
  container:
    image: sdkautomation.azurecr.io/openapi-sdk-automation:test
    endpoint: sdkautomationv2-registry
  timeoutInMinutes: 180

  variables:
      NODE_OPTIONS: '--max-old-space-size=8192'
      BLOB_STORAGE_PREFIX: sdkautomation-pipeline
      SPEC_REPO: $(Build.Repository.Name)
      PR_NUMBER: $(System.PullRequest.PullRequestNumber)
  strategy:
    matrix:
      Net:
        SDK_REPO_NAME: azure-sdk-for-net
      Java:
        SDK_REPO_NAME: azure-sdk-for-java
      JavaScript:
        SDK_REPO_NAME: azure-sdk-for-js
      Python:
        SDK_REPO_NAME: azure-sdk-for-python
      Go:
        SDK_REPO_NAME: azure-sdk-for-go
  steps:
  - checkout: none
  - script: printenv
    displayName: Display ENV
  - script: git config --global user.email "sdkautomation@microsoft.com" && git config --global user.name "SDK Automation"
    displayName: Configure Git
  - script: sudo chown `id -ng`:`id -ng` . && npm start
    env:
      BLOB_STORAGE_NAME: $(blob-storage-name)
      BLOB_STORAGE_KEY: $(blob-storage-key)
      GITHUB_COMMENT_AUTHOR_NAME: $(github-comment-author-name)
      GITHUBAPP_ID: $(githubapp-id)
      GITHUBAPP_PRIVATE_KEY: $(githubapp-private-key)
    displayName: SDK Automation
    workingDirectory: /z
